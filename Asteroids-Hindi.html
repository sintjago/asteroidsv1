<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>शब्द उल्का</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100vh;
      overflow: hidden;
      font-family: Arial, sans-serif;
      background-color: #fff;
      color: #000;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 {
      margin: 6px 0;
      font-size: 3.5vw;
      color: #333;
      text-align: center;
    }
    .game-container {
      background: #e0e0e0;
      padding: 10px;
      border-radius: 10px;
      border: 3px solid #888;
      display: flex;
      flex-direction: column;
      align-items: center;
      max-height: calc(100vh - 50px);
      overflow: hidden;
      width: 95vw;
      max-width: 640px;
    }
    canvas {
      background-color: #000;
      border: 2px solid #444;
      width: 100%;
      height: auto;
      max-height: 60vh;
      display: block;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      gap: 8px;
      font-size: 3.5vw;
      margin-top: 6px;
      text-align: center;
    }
    #wordLine {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 6px;
      margin-bottom: 12px;
      font-size: 3.5vw;
      font-weight: bold;
    }
    select, button, input {
      font-size: 3.5vw;
    }
    #completedWords {
      margin-top: 8px;
      color: #333;
      font-size: 3.5vw;
    }
    .completed-word {
      cursor: pointer;
      margin: 3px;
      display: inline-block;
      padding: 3px 6px;
      background: #eee;
      border: 1px solid #888;
      border-radius: 5px;
      font-size: 3.5vw;
    }
    .completed-word:hover {
      background-color: #ddd;
    }
    #customListContainer {
      margin-top: 8px;
      text-align: center;
      font-size: 16px;
    }
    @media (min-width: 600px) {
      h1 { font-size: 24px; }
      .controls, select, button, input, #completedWords, .completed-word, #wordLine {
        font-size: 16px;
      }
    }
  </style>
</head>
<body>
  <h1>शब्द उल्का</h1>
  <div class="game-container">
    <canvas id="gameCanvas" width="640" height="480"></canvas>

    <div class="controls">
      <label for="numLetters">अक्षरों की संख्या:</label>
      <select id="numLetters">
        <option value="5">5</option>
        <option value="10">10</option>
        <option value="15">15</option>
        <option value="20" selected>20</option>
        <option value="30">30</option>
        <option value="40">40</option>
        <option value="50">50</option>
      </select>
      <button id="nextWordButton">नया शब्द</button>
      <span id="scoreDisplay">अंक: 0</span> |
      <span id="livesDisplay">जीवन: 3</span>
    </div>

    <div id="wordLine">
      <span id="targetWord">लक्ष्य शब्द:</span>
      <span id="progressWord">प्रगति:</span>
    </div>

    <div class="instructions">
      Q/R से घुमाएँ, तीर कुंजियाँ चलाने के लिए, स्पेसबार से गोली चलाएँ
    </div>

    <div id="customListContainer">
      कस्टम शब्द सूची:
      <input type="text" id="customWords" placeholder="शब्दों को कॉमा से अलग करें" />
      <button onclick="submitCustomList()">सूची लागू करें</button>
    </div>

    <div id="completedWords"><strong>पूर्ण शब्द:</strong> <span id="completedList"></span></div>
  </div>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    let ship = { x: canvas.width / 2, y: canvas.height / 2, angle: 0, speed: 2, radius: 10 };
    let score = 0, lives = 3;
    const shots = [], shotSpeed = 5;
    let bubbles = [];
    const completedWords = [];
    const alphabet = {
      hi: 'अआइईउऊऋएऐओऔकखगघचछजझटठडढणतथदधनपफबभमयरलवशषसह'
    };
    let language = 'hi';
    let numLetters = 20;
    let moveUp = false, moveDown = false, moveLeft = false, moveRight = false;

    const wordList = {
      hi: ["सेब", "पुस्तक", "कुत्ता", "बिल्ली", "स्कूल", "नदी", "पानी", "पेड़", "बस", "कंप्यूटर"]
    };

    let currentWord = '', currentLetterIndex = 0;

    const targetWordEl = document.getElementById("targetWord");
    const progressWordEl = document.getElementById("progressWord");
    const scoreEl = document.getElementById("scoreDisplay");
    const livesEl = document.getElementById("livesDisplay");
    const completedListEl = document.getElementById("completedList");

    function setNewWord() {
      const words = wordList[language];
      currentWord = words[Math.floor(Math.random() * words.length)];
      currentLetterIndex = 0;
      updateWordDisplay();
    }

    function updateWordDisplay() {
      targetWordEl.textContent = `लक्ष्य शब्द: ${currentWord}`;
      const progress = currentWord.split('').map((ch, i) => i < currentLetterIndex ? ch : '_').join(' ');
      progressWordEl.textContent = `प्रगति: ${progress}`;
    }

    function updateScoreboard() {
      scoreEl.textContent = `अंक: ${score}`;
      livesEl.textContent = `जीवन: ${lives}`;
    }

    function submitCustomList() {
      const input = document.getElementById("customWords").value;
      const customWords = input.split(',').map(w => w.trim()).filter(Boolean);
      if (customWords.length > 0) {
        wordList[language] = customWords;
        setNewWord();
        spawnBubbles();
      }
    }

    function spawnBubbles() {
      bubbles = [];
      const uniqueLetters = [...new Set(currentWord.split(''))];
      for (let letter of uniqueLetters) {
        bubbles.push(generateBubble(letter));
      }
      while (bubbles.length < numLetters) {
        bubbles.push(generateBubble());
      }
    }

    function generateBubble(forceLetter) {
      const nextNeeded = currentLetterIndex < currentWord.length ? currentWord[currentLetterIndex] : null;
      const isTarget = Math.random() < 0.4;
      const letter = forceLetter || ((isTarget && nextNeeded)
        ? nextNeeded
        : alphabet[language][Math.floor(Math.random() * alphabet[language].length)]);
      const x = Math.random() * canvas.width;
      const y = Math.random() * canvas.height / 2;
      const dx = (Math.random() - 0.5) * 4;
      const dy = (Math.random() - 0.5) * 4;
      const color = `hsl(${Math.random() * 360}, 80%, 15%)`;
      return { x, y, dx, dy, radius: 15, letter, color };
    }

    function synthVoice(text) {
      if (!window.speechSynthesis) return;
      window.speechSynthesis.cancel();
      const voices = window.speechSynthesis.getVoices();
      let hiVoice = voices.find(v => v.lang === 'hi-IN' || v.lang.startsWith('hi'));
      if (!hiVoice && voices.length === 0) {
        window.speechSynthesis.onvoiceschanged = () => synthVoice(text);
        return;
      }
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = 'hi-IN';
      if (hiVoice) utter.voice = hiVoice;
      window.speechSynthesis.speak(utter);
    }

    function addCompletedWord(word) {
      const span = document.createElement("span");
      span.className = "completed-word";
      span.textContent = word;
      span.onclick = () => synthVoice(word);
      completedListEl.appendChild(span);
    }

    function fireShot() {
      const tipX = ship.x + ship.radius * Math.sin(ship.angle);
      const tipY = ship.y - ship.radius * Math.cos(ship.angle);
      shots.push({
        x: tipX,
        y: tipY,
        dx: shotSpeed * Math.sin(ship.angle),
        dy: -shotSpeed * Math.cos(ship.angle),
        radius: 5
      });
    }

    function moveEntities() {
      if (moveUp) ship.y -= ship.speed;
      if (moveDown) ship.y += ship.speed;
      if (moveLeft) ship.x -= ship.speed;
      if (moveRight) ship.x += ship.speed;
      ship.x = (ship.x + canvas.width) % canvas.width;
      ship.y = (ship.y + canvas.height) % canvas.height;
      shots.forEach((s, i) => {
        s.x += s.dx;
        s.y += s.dy;
        if (s.x < 0 || s.x > canvas.width || s.y < 0 || s.y > canvas.height) shots.splice(i, 1);
      });
      bubbles.forEach(b => {
        b.x += b.dx;
        b.y += b.dy;
        if (b.x < 0 || b.x > canvas.width) b.dx *= -1;
        if (b.y < 0 || b.y > canvas.height) b.dy *= -1;
      });
    }

    function drawGame() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawShip();
      drawBubbles();
      drawShots();
    }

    function drawShip() {
      ctx.save();
      ctx.translate(ship.x, ship.y);
      ctx.rotate(ship.angle);
      ctx.beginPath();
      ctx.moveTo(0, -ship.radius);
      ctx.lineTo(ship.radius, ship.radius);
      ctx.lineTo(-ship.radius, ship.radius);
      ctx.closePath();
      ctx.fillStyle = "#32CD32";
      ctx.fill();
      ctx.restore();
    }

    function drawBubbles() {
      bubbles.forEach(b => {
        ctx.beginPath();
        ctx.arc(b.x, b.y, b.radius, 0, Math.PI * 2);
        ctx.fillStyle = b.color;
        ctx.fill();
        ctx.strokeStyle = "#fff";
        ctx.lineWidth = 2;
        ctx.stroke();
        ctx.fillStyle = "#fff";
        ctx.font = "bold 16px Arial";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText(b.letter, b.x, b.y);
      });
    }

    function drawShots() {
      shots.forEach(shot => {
        ctx.beginPath();
        ctx.arc(shot.x, shot.y, shot.radius, 0, Math.PI * 2);
        ctx.fillStyle = "#FFD700";
        ctx.fill();
      });
    }

    function checkCollisions() {
      for (let i = shots.length - 1; i >= 0; i--) {
        const shot = shots[i];
        for (let j = bubbles.length - 1; j >= 0; j--) {
          const bubble = bubbles[j];
          const dx = shot.x - bubble.x;
          const dy = shot.y - bubble.y;
          const dist = Math.sqrt(dx * dx + dy * dy);
          if (dist < shot.radius + bubble.radius) {
            synthVoice(bubble.letter);
            bubbles.splice(j, 1);
            shots.splice(i, 1);
            if (bubble.letter === currentWord[currentLetterIndex]) {
              currentLetterIndex++;
              score++;
              updateScoreboard();
              updateWordDisplay();
              if (currentLetterIndex === currentWord.length) {
                score += 10;
                updateScoreboard();
                synthVoice(currentWord);
                addCompletedWord(currentWord);
                setTimeout(() => {
                  setNewWord();
                  spawnBubbles();
                }, 300);
              } else {
                bubbles.push(generateBubble());
              }
            } else {
              bubbles.push(generateBubble());
            }
            break;
          }
        }
      }

      for (let j = bubbles.length - 1; j >= 0; j--) {
        const bubble = bubbles[j];
        const dx = ship.x - bubble.x;
        const dy = ship.y - bubble.y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist < ship.radius + bubble.radius) {
          lives--;
          updateScoreboard();
          bubbles.splice(j, 1);
          bubbles.push(generateBubble());
          if (lives <= 0) {
            alert("खेल समाप्त!");
            resetGame();
          }
        }
      }
    }

    function update() {
      moveEntities();
      drawGame();
      checkCollisions();
      requestAnimationFrame(update);
    }

    function resetGame() {
      score = 0;
      lives = 3;
      moveUp = false;
      moveDown = false;
      moveLeft = false;
      moveRight = false;
      ship.x = canvas.width / 2;
      ship.y = canvas.height / 2;
      ship.angle = 0;
      setNewWord();
      spawnBubbles();
      updateScoreboard();
    }

    document.getElementById("numLetters").onchange = e => {
      numLetters = parseInt(e.target.value);
      spawnBubbles();
    };

    document.getElementById("nextWordButton").onclick = () => {
      setNewWord();
      spawnBubbles();
    };

    window.addEventListener("keydown", e => {
      if (["ArrowUp", "ArrowDown", "ArrowLeft", "ArrowRight", " "].includes(e.key)) e.preventDefault();
      if (e.key === "ArrowUp") moveUp = true;
      if (e.key === "ArrowDown") moveDown = true;
      if (e.key === "ArrowLeft") moveLeft = true;
      if (e.key === "ArrowRight") moveRight = true;
      if (e.key === "q") ship.angle -= 0.1;
      if (e.key === "r") ship.angle += 0.1;
      if (e.key === " ") fireShot();
    });

    window.addEventListener("keyup", e => {
      if (e.key === "ArrowUp") moveUp = false;
      if (e.key === "ArrowDown") moveDown = false;
      if (e.key === "ArrowLeft") moveLeft = false;
      if (e.key === "ArrowRight") moveRight = false;
    });

    window.addEventListener("DOMContentLoaded", () => {
      setNewWord();
      spawnBubbles();
      updateScoreboard();
      update();
    });
  </script>
</body>
</html>
